version: '3.3'
services:
  mongo_project-manager:
    restart: always
    image: mongo:5.0.9
    volumes:
      - mongodb_data:/data/db
    ports:
      -  ${MONGO_PORT}:${MONGO_PORT}
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
      - MONGO_INITDB_DATABASE=project_manager
  mongo_express_project-manager:
    restart: always
    image: mongo-express:0.54
    ports:
      - ${ME_PORT}:${ME_PORT}
    environment:
      - ME_CONFIG_MONGODB_SERVER=mongo_project-manager
      - ME_CONFIG_MONGODB_PORT=${MONGO_PORT}
      - ME_CONFIG_MONGODB_ENABLE_ADMIN=${ME_CONFIG_MONGODB_ENABLE_ADMIN}
      - ME_CONFIG_BASICAUTH_USERNAME=${ME_CONFIG_BASICAUTH_USERNAME}
      - ME_CONFIG_BASICAUTH_PASSWORD=${ME_CONFIG_BASICAUTH_PASSWORD}
      - ME_CONFIG_MONGODB_ADMINUSERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - ME_CONFIG_MONGODB_ADMINPASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
      - ME_CONFIG_MONGODB_AUTH_DATABASE=admin
      - ME_CONFIG_MONGODB_AUTH_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - ME_CONFIG_MONGODB_AUTH_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}

    depends_on:
      - mongo_project-manager
  api_project-manager:
    restart: always
    image: node:16.16.0
    volumes:
      - ~/Projects/api_project-manager:/backend
    ports:
      - ${BACKEND_PORT}:${BACKEND_PORT}
    depends_on:
      - mongo_project-manager
    ## Uncomment the line below, if you want to use the development mode
    command: bash -c "mkdir -p /backend && cd /backend && yarn install && yarn dev"
    ## Uncomment the line below, if you want to use the production mode
    # command: bash -c "mkdir -p /backend && cd /backend && yarn install && yarn start"
  project-manager:
    restart: always
    image: node:16.16.0
    volumes:
      - ~/Projects/project-manager:/frontend
    ports:
      - ${FRONTEND_PORT}:${FRONTEND_PORT}
    ## Uncomment the line below, if you want to use the development mode
    command: bash -c "mkdir -p /frontend && cd /frontend && yarn install && yarn dev"
    ## Uncomment the line below, if you want to use the production mode
    # command: bash -c "mkdir -p /frontend && cd /frontend && yarn install && yarn build && yarn start"
volumes:
  mongodb_data: